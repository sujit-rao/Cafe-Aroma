{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="{% static 'images/logo.png' %}" />
    
    <title>Café Aroma</title>
    

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Font awesome cdn link -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- custom css link -->
    <link rel="stylesheet" href="{% static 'css/cart.css' %}" />
    <script src="js/script.js"></script>
  </head>

  <body>
    <section class="cart-page">
      <div class="cart-title">
        Your Cart <span>({{ cart|length }})</span> items
      </div>
      <div class="open-border">
        <div>
          <div class="cart-card-header">
            <div class="cart-card-content-header">
              <h3>Item</h3>
              <div class="cart-details-header">
                <div class="price">Price</div>
                <div class="quantity">Quantity</div>
                <div class="subtotal">Sub Total</div>
              </div>
            </div>
          </div>
          <!-- Cart items -->
          <div class="cart-items">
            {% if cart %}
              {% for item_id, item in cart.items %}
                <div class="cart-card">
                  <img src="{{ item.image_url }}" alt="{{ item.title }}" />
                  <div class="cart-card-content">
                    <h3>{{ item.title }}</h3>
                    <div class="cart-details">
                      <div class="price">₹{{ item.price }}</div>
                      <div class="quantity">{{ item.quantity }}</div>
                      <div class="subtotal">₹{{ item.subtotal }}</div>
                      <a href="{% url 'delete_from_cart' item_id %}" class="delete-button"><i class="fa-solid fa-trash-can"></i></a>
                    </div>
                  </div>
                </div>
              {% endfor %}
            {% else %}
              <p style="text-align: center; font-size: 1.2rem;">Your cart is empty.</p>
            {% endif %}
          </div>
        </div>
        <!-- end of cart items -->

        <!-- total card -->

        <div class="total-card">
          <div class="total-card-content">
            <h3>Total</h3>
            <div class="total">₹{{ total_price }}</div>
            {% if total_price != 0 %}
              <button id="pay-now-button">Pay now</button>
            {% endif %}
          </div>
        </div>

        <!-- end of total card -->

        <div class="back-btn_section">
          <a class="backToHome" href="{% url 'recipe' %}">Back</a>
        </div>
        {% comment %} <a class="backToHome" href="{% url 'recipe' %}">Back</a> {% endcomment %}
      </div>
    </section>
    <!-- Footer -->

    <div class="footer">
      <div class="share">
        <a href="#" class="fab fa-facebook-f"></a>
        <a href="#" class="fab fa-twitter"></a>
        <a href="#" class="fab fa-instagram"></a>
        <a href="#" class="fab fa-linkedin"></a>
      </div>

      <div class="links">
        <a href="{% url 'index' %}">Home</a>
        <a href="{% url 'devpage' %}">Developers</a>
        <a href="{% url 'recipe' %}">Recipes</a>
        <a href="{% url 'contact' %}">Contact</a>
      </div>

      <div class="credit">
        Created by <span>Cafe Aroma</span> | All Rights Reserved
      </div>
    </div>
    <!-- End of footer -->

    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
      document.getElementById('pay-now-button').addEventListener('click', function () {
        Swal.fire({
          title: 'Are you sure?',
          text: 'You are about to proceed to payment.',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: 'Yes, proceed to pay'
        }).then((result) => {
          if (result.isConfirmed) {
            // Redirect to Razorpay or a specific view for payment
            window.location.href = "{% url 'initiate_payment' %}"
          }
        })
      })
    </script>
  </body>
  {% if error %}
    <script>
      Swal.fire({
        title: 'Error!',
        text: '{{ error }}',
        icon: 'error',
        confirmButtonText: 'OK'
      })
    </script>
  {% endif %}

  {% if success %}
    <script>
      Swal.fire({
        title: 'Success!',
        text: '{{ success|escapejs }}', // Escape JS special characters
        icon: 'success',
        confirmButtonText: 'OK'
      })
    </script>
  {% endif %}
</html>
